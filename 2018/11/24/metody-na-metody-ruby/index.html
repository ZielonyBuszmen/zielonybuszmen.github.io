<!DOCTYPE html>
<html lang="pl">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Metody na metody w Ruby</title>
  <meta property="og:title" content="Metody na metody w Ruby" />
  <meta name="twitter:title" content="Metody na metody w Ruby" />
  <meta name="description" content="Tak jak już wspominałem w poprzednim artykule, Ruby ma syntax sugar na wszystko. Także na deklarowanie i wywoływanie metod. W rozbudowanej składni łatwo się pogubić. W tym artykule przedstawię część składni, na którą można natrafić na początku nauki.
Ten wpis jest jednym z serii o Ruby, które pojawiły się na blogu:
 Ruby - ściągawka Metody na metody w Ruby Bloki i moduły w Ruby  Domyślne parametry Tak jak w większości języków programowania, w Ruby istnieją wartości domyślne parametrów metody.">
  <meta property="og:description" content="Tak jak już wspominałem w poprzednim artykule, Ruby ma syntax sugar na wszystko. Także na deklarowanie i wywoływanie metod. W rozbudowanej składni łatwo się pogubić. W tym artykule przedstawię część składni, na którą można natrafić na początku nauki.
Ten wpis jest jednym z serii o Ruby, które pojawiły się na blogu:
 Ruby - ściągawka Metody na metody w Ruby Bloki i moduły w Ruby  Domyślne parametry Tak jak w większości języków programowania, w Ruby istnieją wartości domyślne parametrów metody.">
  <meta name="twitter:description" content="Tak jak już wspominałem w poprzednim artykule, Ruby ma syntax sugar na wszystko. Także na deklarowanie i wywoływanie metod. W rozbudowanej składni łatwo się pogubić. W tym artykule przedstawię część …">
  <meta name="author" content="Zielony Buszmen"/>
  <link href='https://zielonybuszmen.github.io/img/avatar-green.png' rel='icon' type='image/x-icon'/>
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://zielonybuszmen.github.io/2018/11/24/metody-na-metody-ruby" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Zielony Buszmen" />

  <meta name="generator" content="Hugo 0.37" />
  <link rel="canonical" href="https://zielonybuszmen.github.io/2018/11/24/metody-na-metody-ruby" />
  <link rel="alternate" href="https://zielonybuszmen.github.io/index.xml" type="application/rss+xml" title="Zielony Buszmen">
  
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://zielonybuszmen.github.io/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  
  



<link rel="stylesheet" href="https://zielonybuszmen.github.io/prism-highlighter/darcula.css"><link rel="stylesheet" href="https://zielonybuszmen.github.io/styles/my.css">

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Przełącz nawigację</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://zielonybuszmen.github.io/">Zielony Buszmen</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Projekty" href="/MyProjects/">Projekty</a>
            </li>
          
        
          
            <li>
              <a title="O mnie" href="/o-mnie/">O mnie</a>
            </li>
          
        
          
            <li>
              <a title="GitHub" href="https://github.com/ZielonyBuszmen">GitHub</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Menu</a>
              <div class="navlinks-children">
                
                  <a href="/categories">Kategorie</a>
                
                  <a href="/tags">Tagi</a>
                
              </div>
            </li>
          
        

        

        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">Szukaj</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
      </div>
    </div>

  </div>
</nav>



  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Szukajka</h4>
        </div>
        <div class="modal-body">
          <gcse:search linktarget="_parent"></gcse:search>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
        </div>
      </div>
    </div>
  </div>


    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Metody na metody w Ruby</h1>
                
                
                  <span class="post-meta">
  Napisano dnia 2018-11-24
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>Tak jak już wspominałem w poprzednim artykule, Ruby ma <em>syntax sugar</em> na wszystko. Także na deklarowanie i wywoływanie metod. W rozbudowanej składni łatwo się pogubić. W tym artykule przedstawię część składni, na którą można natrafić na początku nauki.</p>

<hr />

<p>Ten wpis jest jednym z serii o <em>Ruby</em>, które pojawiły się na blogu:</p>

<ol>
<li><a href="/2018/10/24/ruby-sciagawka/">Ruby - ściągawka</a></li>
<li><strong>Metody na metody w Ruby</strong></li>
<li><a href="/2019/02/17/bloki-i-moduly/">Bloki i moduły w Ruby</a></li>
</ol>

<hr />

<h3 id="domyślne-parametry">Domyślne parametry</h3>

<p>Tak jak w większości języków programowania, w Ruby istnieją wartości domyślne parametrów metody. Parametry mogą być zwykłym symbolem, liczbą bądź stringiem.</p>

<pre><code class="language-ruby">def create_machine(type = :press, size = 'very big')
  # ...
end
</code></pre>

<p>Dodatkowo, domyślny parametr może być warunkiem bądź wynikiem wywołania funkcji:</p>

<pre><code class="language-ruby">def create_machine(type = :press, size = (type == :press ? :big : :small))
  # ...
end

def create_machine(type = :press, size = calc_size(type))
  # ...
end
</code></pre>

<p>Jak by tego było mało, domyślne parametry nie muszą być koniecznie na końcu listy. Możemy równie dobrze umieścić je na samym początku:</p>

<pre><code class="language-ruby"># `name` nie ma wartości domyślnej, jest ostatnie na liście
def create_machine(type = :press, size = :big, name) 
  # ...
end

# przekazujemy jawnie tylko parametr `name`
create_machine('machine') 

# przekazujemy jawnie parametr `type` i `name`
create_machine(:typeB, 'machine') 
</code></pre>

<h3 id="zmienna-ilość-parametrów">Zmienna ilość parametrów</h3>

<p>Aby odczytać <em>wszystkie</em> parametry przekazane do funkcji, wystarczy użyć operatora <em>splat</em>, czyli gwiazdki (<em>*</em>)</p>

<pre><code class="language-ruby">def produce_machines(days, *types)
  # ...
end

produce_machines(5, :aircraft, :explorer, :android)
</code></pre>

<p>Zmienna <code>types</code> jest tablicą, której wartości to kolejne parametry. W naszym przypadku tablica ta będzie miała postać <code>[:aircraft, :explorer, :android]</code>.</p>

<h3 id="argumenty-nazwane">Argumenty nazwane</h3>

<p>W Ruby możemy tworzyć <em>argumenty nazwane</em>. Przy wywoływaniu funkcji będziemy musieli jawnie podać nazwę argumentu wraz z wartością:</p>

<pre><code class="language-ruby"># definicja funkcji z argumentami nazwanymi
def create_machine(type:, size:, name:, weight:)
  # ...
end

# zauważmy, że przy wywołaniu parametry mogą być podawane w dowolnej kolejności
create_machine(name: 'clever',type: :champ, size: 'm', weight: 200)
</code></pre>

<p><em>Argumenty nazwane</em> mogą posiadać także swoje domyślne wartości:</p>

<pre><code class="language-ruby">def create_machine(type: 'something', size: :big, name: 'noname', weight: 100)
  # ...
end

create_machine(type: :champ, size: 'm')
</code></pre>

<p>Tak jak w przypadku zwykłych argumentów, funkcja może przyjmować zmienną ilość <em>argumentów nazwanych</em>. Użyjemy do tego <em>double splat operator</em> (czyli <code>**</code>):</p>

<pre><code class="language-ruby">def create_machine(type: :press, **elements)
  # ...
end

create_machine(type: :champ, size: 'm', weight: 200, name: 'clever')
</code></pre>

<p>Zmienna <code>elements</code> będzie zawierała hash o postaci: <code>{:size=&gt;&quot;m&quot;, :weight=&gt;200, :name=&gt;&quot;clever&quot;}</code></p>

<h3 id="aliasy-metod">Aliasy metod</h3>

<p><em>Ruby</em> umożliwia stosowanie tzw. <em>monkey patching</em>, czyli nadpisywanie domyślnych metod, które są zawarte we wbudowanych klasach. I tak oto możemy w klasie <code>String</code> nadpisać metodę <code>size()</code> swoją własną implementacją. Jednakże wówczas tracimy dostęp do oryginalnej metody. Receptą na to jest stosowanie aliasów metod:</p>

<pre><code class="language-ruby">class String
  # przypisanie oryginalnej metodzie `size()` nowej nazwy - `original_size()`
  alias_method :original_size, :size

  def size
  # wywołanie oryginalnej metody `size()`, która istnieje pod nazwą `original_size()`
    original_size * 2 - 1 
  end
end

puts 'test'.size # zwróci 7, bo 4 * 2 - 1
</code></pre>

<h3 id="przeciążanie-operatorów">Przeciążanie operatorów</h3>

<p>Każda klasa może implementować własne zachowania operatorów. Poniżej kilka przykładów:</p>

<pre><code class="language-ruby">class Ship
  attr_reader :name, :speed

  def initialize(name)
    @name = name
    @cargo = []
    @speed = 0
    @passangers = Hash.new {[]}
  end

  def [](type) # użycie: jackdaw['cos']
    @passangers[type]
  end

  def []=(type, name) # użycie: jackdaw['cos'] = ['wartosc', 'itd']
    @passangers[type] = name
  end

  def &lt;&lt;(cargo) # użycie: jackdaw &lt;&lt; 'ladunek'
    @cargo &lt;&lt; cargo
  end

  def +@ # użycie: +jackdaw
    @speed += 15
  end

  def -@ # użycie: -jackdaw
    @speed -= 15
  end

  def ! # użycie: if !jackdaw ...
    puts 'obiekt tej klasy możemy używać jako warunek'
  end
end

jackdaw = Ship.new('Jackdaw')

jackdaw[:professors] = ['Duncan Walpole', 'Adam Smith'] 
# @passangers={:professors=&gt;[&quot;Duncan Walpole&quot;, &quot;Adam Smith&quot;]}

jackdaw &lt;&lt; 'carbon' # @cargo=[&quot;carbon&quot;]
+jackdaw # @speed=15
</code></pre>

<h3 id="wywoływanie-funkcji-przez-wiadomości">Wywoływanie funkcji przez wiadomości</h3>

<p>Wywoływanie metod w <code>Ruby</code> odbywa się poprzez wysyłanie wiadomości do obiektu. Wiadomość taka posiada nazwę metody oraz parametry. Obiekt, po odebraniu wiadomości, wyszukuje odpowiednią metodę, i jeśli ją znajdzie, wywołuje ją.</p>

<p>Możemy użyć tego mechanizmu ręcznie za pomocą metody <code>send()</code>:</p>

<pre><code class="language-ruby"># wywoła metodę `dock()` z obiektu `ship`
ship.send('dock') # równoznaczne z `ship.dock()`
</code></pre>

<p>Mechanizm ten został zapożyczony z języka <code>Smalltalk</code>.</p>

<p>Powstaje pytanie, co z metodami, które nie zostały zadeklarowane w żadnej klasie? Wywołania metod wymagają obiektu, który te wywołanie odbierze. Każdy program w <em>Ruby</em> posiada domyślny obiekt <code>main</code>. I to ten obiekt odbierze wszystkie wiadomości. Warto dodać, że wywołanie <code>self</code> bez kontekstu będzie odwoływało się właśnie do obiektu <code>main</code>.</p>

<h3 id="zagubione-metody-method-missing">Zagubione metody - <code>method_missing</code></h3>

<p>Gdy spróbujemy wywołać metodę, która nie istnieje w klasie, to zostanie wyrzucony błąd <code>NoMethodError</code>. Możemy jednak zadeklarować w klasie metodę <code>method_missing()</code>, która przechwyci takie wywołania i odpowiednio je obsłuży.</p>

<pre><code class="language-ruby">class Ship
  def method_missing(name, *args)
    p name, args
  end
end

jackdaw = Ship.new
jackdaw.weight_and_balance # wyświetli: weight_and_balance []
jackdaw.with_parameter(123, 'asd') # wyświetli: with_parameter [123, &quot;asd&quot;]
</code></pre>

<h3 id="podsumowując">Podsumowując</h3>

<p>Ruby posiada wiele <em>magii</em>, które mogą przytłaczać. Ważne jest, abyśmy ich nie nadużywali w swoich projektach, ponieważ skutecznie zaciemniają kod. Utrzymanie projektu opartego o magiczne metody, lub przeciążone operatory, nie należy do najprzyjemniejszych. Ruby nie posiada także statycznego typowania, więc na poziomie czytania kodu nie jest łatwo określić, czym właściwie dana zmienna jest, co jeszcze bardziej utrudnia zrozumienie.</p>

      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://zielonybuszmen.github.io/2019/02/17/bloki-i-moduly/" data-toggle="tooltip" data-placement="top" title="Bloki i moduły w Ruby">&larr; Nowszy post </a>
          </li>
        
        
          <li class="next">
            <a href="https://zielonybuszmen.github.io/2018/10/24/ruby-sciagawka/" data-toggle="tooltip" data-placement="top" title="Ruby - ściągawka">Starszy post &rarr;</a>
          </li>
        
      </ul>

      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "zielonybuszmen-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/ZielonyBuszmen" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://zielonybuszmen.github.io/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://zielonybuszmen.github.io/">Zielony Buszmen</a>
                      
          
          
          &nbsp;&bull;&nbsp;
          2019

          
            &nbsp;&bull;&nbsp;
            <a href="https://zielonybuszmen.github.io/">Zielony Buszmen</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          To wszystko działa dzięki <a href="https://pages.github.com/">Github Pages</a> oraz <a href="https://gohugo.io/">GoHugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>



<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://zielonybuszmen.github.io/js/main.js"></script>
<script src="https://zielonybuszmen.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>







<script>
  (function() {
    var cx = '007478084746714163272:uz5nuajlf-i';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

<script src="/prism-highlighter/prism.js"></script>
<script src="/js/my.js"></script>

  </body>
</html>

